project(example)
cmake_minimum_required(VERSION 3.9.0)


set (CMAKE_VERBOSE_MAKEFILE ON)
set (PACKAGE_NAME "Pixi")
set (CMAKE_CXX_STANDARD 17)

set(OpenCV_DIR  ${CMAKE_CURRENT_SOURCE_DIR}/cpp-modules/opencv/sdk/native/jni/)
find_package(OpenCV REQUIRED)
include_directories(${OpenCV_INCLUDE_DIRS})

find_package(react-native-vision-camera REQUIRED CONFIG)
find_package(ReactAndroid REQUIRED CONFIG)
find_package(fbjni REQUIRED CONFIG)

add_library(
        ${PACKAGE_NAME}
        SHARED
        ../../../../src/parsers.cpp
        cpp/JniOnLoad.cpp
        cpp/PixiHostObject.cpp
        cpp/PixiProxy.cpp
)


target_include_directories(
        ${PACKAGE_NAME}
        PRIVATE
        "../../../../include"
        "../../../../lib/include"
        "cpp/include"
        "${NODE_MODULES_DIR}/react-native/ReactCommon"
        "${NODE_MODULES_DIR}/react-native/ReactCommon/callinvoker"
        "${NODE_MODULES_DIR}/react-native/ReactAndroid/src/main/jni/react/turbomodule"
        "${NODE_MODULES_DIR}/react-native-vision-camera/android/src/main/cpp"
        "${NODE_MODULES_DIR}/react-native-vision-camera/android/src/main/cpp/frameprocessor/java-bindings"
        "${OpenCV_INCLUDE_DIRS}"
)


set(GENERATORS_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../../../lib/jni/generators/${ANDROID_ABI}/)

add_library(image_resizer STATIC IMPORTED)
set_target_properties(image_resizer PROPERTIES
        IMPORTED_LOCATION
        ${GENERATORS_DIR}/image_resizer.a
        )


add_library(yuv_to_rgba888 STATIC IMPORTED)
set_target_properties(yuv_to_rgba888 PROPERTIES
        IMPORTED_LOCATION
        ${GENERATORS_DIR}/yuv_to_rgba888.a)


set_target_properties(${PACKAGE_NAME} PROPERTIES LINKER_LANGUAGE CXX)

target_link_libraries(
        ${PACKAGE_NAME}
        android
        log
        ReactAndroid::jsi
        ReactAndroid::reactnativejni
        fbjni::fbjni
        ${OpenCV_LIBS}
        image_resizer
        yuv_to_rgba888
        react-native-vision-camera::VisionCamera

)
